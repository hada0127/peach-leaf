<script lang="ts">
  interface Props {
    mode: 'edit' | 'preview';
    textColor?: string;
    'ontoggle-mode'?: () => void;
    onclose?: () => void;
  }

  let { mode, textColor = '#71717A', 'ontoggle-mode': ontogglemode, onclose }: Props = $props();

  function toggleMode() {
    console.log('Toolbar toggleMode clicked');
    ontogglemode?.();
  }

  function close() {
    onclose?.();
  }
</script>

<div class="toolbar">
  <div class="drag-handle">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path d="M9.0957 8.25C8.40535 8.25 7.8457 7.69036 7.8457 7C7.8457 6.30964 8.40535 5.75 9.0957 5.75C9.78606 5.75 10.3457 6.30964 10.3457 7C10.3457 7.69036 9.78606 8.25 9.0957 8.25ZM9.0957 13.25C8.40535 13.25 7.8457 12.6904 7.8457 12C7.8457 11.3096 8.40535 10.75 9.0957 10.75C9.78606 10.75 10.3457 11.3096 10.3457 12C10.3457 12.6904 9.78606 13.25 9.0957 13.25ZM7.8457 17C7.8457 17.6904 8.40535 18.25 9.0957 18.25C9.78606 18.25 10.3457 17.6904 10.3457 17C10.3457 16.3096 9.78606 15.75 9.0957 15.75C8.40535 15.75 7.8457 16.3096 7.8457 17Z" fill="{textColor}"/>
      <path d="M14.9043 8.25C14.2139 8.25 13.6543 7.69036 13.6543 7C13.6543 6.30964 14.2139 5.75 14.9043 5.75C15.5947 5.75 16.1543 6.30964 16.1543 7C16.1543 7.69036 15.5947 8.25 14.9043 8.25ZM14.9043 13.25C14.2139 13.25 13.6543 12.6904 13.6543 12C13.6543 11.3096 14.2139 10.75 14.9043 10.75C15.5947 10.75 16.1543 11.3096 16.1543 12C16.1543 12.6904 15.5947 13.25 14.9043 13.25ZM13.6543 17C13.6543 17.6904 14.2139 18.25 14.9043 18.25C15.5947 18.25 16.1543 17.6904 16.1543 17C16.1543 16.3096 15.5947 15.75 14.9043 15.75C14.2139 15.75 13.6543 16.3096 13.6543 17Z" fill="{textColor}"/>
    </svg>
  </div>

  <div class="controls">
    <button class="btn mode-btn {mode}" onclick={toggleMode} title="{mode === 'edit' ? 'Switch to Preview (⌘M)' : 'Switch to Edit (⌘M)'}">
      {#if mode === 'edit'}
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M14.7516 6.64122C14.5727 6.77773 14.3555 6.99314 14.0102 7.33847L6.8161 14.5325C6.59892 14.7497 6.57257 14.7831 6.555 14.8142C6.53743 14.8452 6.52234 14.885 6.44785 15.1829L5.82474 17.6754L8.31717 17.0523C8.61513 16.9778 8.65491 16.9627 8.68595 16.9451C8.71698 16.9275 8.75039 16.9012 8.96757 16.684L16.1616 9.48994C16.507 9.14462 16.7224 8.9274 16.8589 8.74848C16.9848 8.58341 16.9859 8.52317 16.9859 8.5C16.9859 8.47682 16.9848 8.41658 16.8589 8.25151C16.7224 8.07259 16.507 7.85537 16.1616 7.51005L15.9901 7.33847C15.6447 6.99315 15.4275 6.77773 15.2486 6.64122C15.0835 6.51528 15.0233 6.51421 15.0001 6.51421C14.9769 6.51421 14.9167 6.51528 14.7516 6.64122ZM5.32636 17.7901C5.32638 17.7901 5.32715 17.7901 5.32861 17.79L5.32636 17.7901ZM5.7101 18.1715C5.71006 18.173 5.71 18.1737 5.70998 18.1738L5.7101 18.1715ZM14.0237 5.6872C14.2955 5.47981 14.6091 5.31421 15.0001 5.31421C15.3912 5.31421 15.7047 5.47981 15.9765 5.6872C16.2273 5.87853 16.5015 6.15279 16.8118 6.46313L17.037 6.68835C17.3473 6.99863 17.6216 7.27284 17.8129 7.52361C18.0203 7.79542 18.1859 8.10895 18.1859 8.5C18.1859 8.89104 18.0203 9.20457 17.8129 9.47638C17.6216 9.72715 17.3473 10.0014 17.037 10.3116L9.8161 17.5325C9.80429 17.5443 9.79254 17.5561 9.78082 17.5679C9.62165 17.7275 9.46864 17.881 9.27719 17.9894C9.08574 18.0977 8.87543 18.15 8.65666 18.2044C8.64055 18.2084 8.6244 18.2124 8.60821 18.2164L5.95409 18.88C5.94446 18.8824 5.93473 18.8848 5.92492 18.8873C5.77085 18.9259 5.59658 18.9696 5.44831 18.9841C5.28319 19.0002 4.98395 18.9987 4.74267 18.7574C4.50138 18.5162 4.4999 18.2169 4.51605 18.0518C4.53056 17.9035 4.57423 17.7293 4.61284 17.5752C4.6153 17.5654 4.61774 17.5557 4.62015 17.546L5.28368 14.8919C5.28772 14.8757 5.29174 14.8596 5.29574 14.8435C5.3501 14.6247 5.40237 14.4144 5.51076 14.2229C5.61916 14.0315 5.7726 13.8785 5.93223 13.7193C5.94398 13.7076 5.95577 13.6958 5.96757 13.684L13.1885 6.46312C13.4988 6.15278 13.773 5.87852 14.0237 5.6872Z" fill="{textColor}"/>
          <path d="M13 7.66667L15.5 6L18 8.5L16.3333 11L13 7.66667Z" fill="{textColor}"/>
        </svg>
      {:else}
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 16C13.25 16 14.3125 15.5625 15.1875 14.6875C16.0625 13.8125 16.5 12.75 16.5 11.5C16.5 10.25 16.0625 9.1875 15.1875 8.3125C14.3125 7.4375 13.25 7 12 7C10.75 7 9.6875 7.4375 8.8125 8.3125C7.9375 9.1875 7.5 10.25 7.5 11.5C7.5 12.75 7.9375 13.8125 8.8125 14.6875C9.6875 15.5625 10.75 16 12 16ZM12 14.2C11.25 14.2 10.6125 13.9375 10.0875 13.4125C9.5625 12.8875 9.3 12.25 9.3 11.5C9.3 10.75 9.5625 10.1125 10.0875 9.5875C10.6125 9.0625 11.25 8.8 12 8.8C12.75 8.8 13.3875 9.0625 13.9125 9.5875C14.4375 10.1125 14.7 10.75 14.7 11.5C14.7 12.25 14.4375 12.8875 13.9125 13.4125C13.3875 13.9375 12.75 14.2 12 14.2ZM12 19C9.56667 19 7.35 18.3208 5.35 16.9625C3.35 15.6042 1.9 13.7833 1 11.5C1.9 9.21667 3.35 7.39583 5.35 6.0375C7.35 4.67917 9.56667 4 12 4C14.4333 4 16.65 4.67917 18.65 6.0375C20.65 7.39583 22.1 9.21667 23 11.5C22.1 13.7833 20.65 15.6042 18.65 16.9625C16.65 18.3208 14.4333 19 12 19Z" fill="{textColor}"/>
        </svg>
      {/if}
    </button>

    <button class="btn close" onclick={close} title="Close">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M18.4247 6.42429C18.659 6.18997 18.659 5.81007 18.4247 5.57576C18.1903 5.34145 17.8104 5.34145 17.5761 5.57576L12.0004 11.1515L6.42465 5.57576C6.19034 5.34145 5.81044 5.34145 5.57613 5.57576C5.34181 5.81007 5.34181 6.18997 5.57613 6.42429L11.1519 12L5.57613 17.5758C5.34181 17.8101 5.34181 18.19 5.57613 18.4243C5.81044 18.6586 6.19034 18.6586 6.42465 18.4243L12.0004 12.8486L17.5761 18.4243C17.8104 18.6586 18.1903 18.6586 18.4247 18.4243C18.659 18.19 18.659 17.8101 18.4247 17.5758L12.8489 12L18.4247 6.42429Z" fill="{textColor}"/>
      </svg>
    </button>
  </div>
</div>

<style>
  .toolbar {
    display: flex;
    align-items: center;
    padding: 4px 8px;
    background: rgba(0, 0, 0, 0.03);
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    cursor: move;
    user-select: none;
    min-height: 24px;
  }

  .drag-handle {
    margin-right: 6px;
    opacity: 0.4;
    display: flex;
    align-items: center;
  }

  .drag-handle svg {
    width: 16px;
    height: 16px;
  }

  .controls {
    display: flex;
    gap: 4px;
    flex: 1;
  }

  .btn {
    padding: 2px 4px;
    border: none;
    background: transparent;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn svg {
    width: 18px;
    height: 18px;
  }

  .btn:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  .btn:active {
    background: rgba(0, 0, 0, 0.1);
  }

  .btn.close {
    margin-left: auto;
  }

  .btn.close:hover {
    background: rgba(211, 51, 51, 0.1);
  }
</style>
